![Logo](http://image.noelshack.com/fichiers/2022/45/4/1668108629-logo-violet-petit.png)

# Planning_Lyon_Palmes

Une application permettant de créer un planning des entrainements doit être développée par les personnes du back-office. Elle est utilisée par le(s) entraineur(s). Cette application permet l’affectation des entraineurs aux entrainements en piscine. 
Dans cette application, un entraineur (et un seul) est chargé de construire le planning. Les autres entraineurs le visualisent, et signalent s’ils sont indisponibles sur un (ou plusieurs) créneaux qui leurs ont été affectés. Les entraineurs disponibles à cette date peuvent se proposer pour échanger une de leur séance contre celle qui pose souci. Mais seul l’entraineur qui est responsable du planning peut opérer la modification. 

## Installation de Postgresql

Installation de postgresql pour la partie base de donnée de l'application.

```bash
   sudo apt install postgresql postgresql-contrib
   sudo service postgresql start
   sudo -i -u postgres
   psql
```

Commandes utiles lors de l'utilisation de postgresql :

`\q` et `exit` pour sortir de l'interface.

`\conninfo` pour voir les détails de la connexion.

`\l` pour voir la liste des bases de données présentes.

`\du` pour voir la liste des utilisateurs avec les privilèges.

`\password` pour l'assignement du mot de passe.

Création de la base de donnée dans la console postgres :

```bash
   CREATE DATABASE planning;
```

## Installation de l'environnement de développement Python Django

Création de l'environnement python et initilisation du projet avec le framework back-end Django.

```bash
   git clone git@gitlab.chassagnes.local:grp_sio2/grp_labo_slam/planning_lyon_palmes.git
   python3 -m venv .env
   source .env/bin/activate
   pip install django psycopg2 docutils django-encrypted-model-fields Faker reportlab
```

Informations concernant les commandes :

Création de l'environnement de développement avec python.

`python3 -m venv .env`

Activation de l'environnement de développement avec python.

`source .env/bin/activate`

(Pour désactiver l'environnement de développement avec python: **deactivate**).

Utilisation de pip pour l'installation des paquets propre à l'envrionnement, pour l'installer :

Hors environnement! : `sudo apt install python3-pip`

| Paquets                       | Références d'utilisations                           |
| ----------------------------- | --------------------------------------------------- |
| django                        | Installation de django à la dernière version        |
| psycopg2                      | Installation pour postgresql via django             |
| docutils                      | Installation de la documentation auto-générée       |
| django-encrypted-model-fields | Installation pour chiffrer les données des models   |
| Faker                         | Installation d'une factory pour générer les données |
| reportlab                     | Installation pour le rendu au format PDF            |

Création d'un fichier requirements.txt nécessaire pour la réinstallation rapide l'environnement de développement.

`pip freeze > requirements.txt`

Initialisation de Django.

`django-admin startproject main`

Renommer le premier dossier **main** en **src** :

`mv main src`

Ajout d'un fichier **.gitignore** pour l'environnement python.

`nano .gitignore` > .env/

Initialisation de l'application.

`cd src && python3 manage.py startapp planning`

Génération de la clé pour le chiffrement des données de la base de donnée.

`python3 manage.py generate_encryption_key`

Modification du fichier **settings.py** :

```python
"""
Django settings for main project.

Generated by 'django-admin startproject' using Django 4.1.3.

For more information on this file, see
https://docs.djangoproject.com/en/4.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/4.1/ref/settings/
"""
import os
from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/4.1/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-4x9op_m0*p)iv%#jkr$)oa9b99wj)^%_+wg16&b7o5(j4sqhlr'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.admindocs',
    'encrypted_model_fields',
    'planning'
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'django.contrib.admindocs.middleware.XViewMiddleware'
]

ROOT_URLCONF = 'main.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [
            str(BASE_DIR.joinpath('templates'))
        ],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'main.wsgi.application'


# Database
# https://docs.djangoproject.com/en/4.1/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'planning',
        'USER': 'postgres',
        'PASSWORD': 'P@ssW0rd',
        'HOST': 'localhost',
        'PORT': ''
    }
}


# Password validation
# https://docs.djangoproject.com/en/4.1/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/4.1/topics/i18n/

LANGUAGE_CODE = 'fr-FR'

TIME_ZONE = 'Europe/Paris'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/4.1/howto/static-files/

STATIC_URL = 'static/'

STATICFILES_DIRS = [
    BASE_DIR / "static"
]

# Default primary key field type
# https://docs.djangoproject.com/en/4.1/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# Encrypted model field

FIELD_ENCRYPTION_KEY = os.environ.get('FIELD_ENCRYPTION_KEY', 'WhahYtv4ystFf8Qq3zkQJc25qLtbmvWN5qBWgieSRtM=')
```

Modificaiton du fichier **urls.py** pour la documentation auto-générée :

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/doc/', include('django.contrib.admindocs.urls')),
    path('admin/', admin.site.urls)
]
```

Démarrer le serveur local django.

`python3 manage.py runserver`

Création d'un superuser.

`python3 manage.py createsuperuser`

Réalisation des migrations pour le fichier **models.py**

`python3 manage.py makemigrations`

`python3 manage.py migrate`

Finalisation avec la création des dossiers **static** et **templates**.

## Documentation technique de l'application

Modélisation de la base de données avec [@drawsql](https://drawsql.app/).

![Screenshot](http://image.noelshack.com/fichiers/2022/49/2/1670314488-screenshot-1.png)

Diagramme de cas d'utilisation.

![Screenshot](http://image.noelshack.com/fichiers/2022/49/2/1670315610-screenshot-1.png)

Installation du projet.

- `git@gitlab.chassagnes.local:grp_sio2/grp_labo_slam/planning_lyon_palmes.git`

- `http://192.168.100.232/grp_sio2/grp_labo_slam/planning_lyon_palmes.git`

`cd planning_lyon_palmes`

`python3 -m venv .env`

`source .env/bin/activate`

`pip install -r requirements.txt`

`python3 src/manage.py makemigrations`

`python3 src/manage.py migrate`

`python3 src/manage.py runserver`

Connexion à l'utilisateur pour la phase de développement : 

- Username : admin

- Password : admin